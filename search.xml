<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[springboot+sharding-jdbc+mybatis+mysql全注解实现增量数据库分片实现]]></title>
      <url>/2017/05/20/spring-boot-sharding-jdbc/</url>
      <content type="html"><![CDATA[<blockquote>
<p>项目中遇到了分库分表的问题，找到了shrding-jdbc，于是就搞了一个springboot+sharding-jdbc+mybatis的增量分片的应用。今天写博客总结一下遇到的坑。</p>
<p>其实，我自己写了一个increament-jdbc组件的，当我读了sharding-jdbc的源码之后，发现思路和原理差不多，sharding这个各方面要比我的强，毕竟我是一天之内赶出来的东东。</p>
<p>示例代码地址:<a href="http://git.oschina.net/qcwz/springboot-sharding-jdbc-demo" target="_blank" rel="external">http://git.oschina.net/qcwz/springboot-sharding-jdbc-demo</a></p>
<p>demo没有写日志，也没有各种异常判断，只是说明问题</p>
</blockquote>
<h2 id="一、需求背景"><a href="#一、需求背景" class="headerlink" title="一、需求背景"></a>一、需求背景</h2><p>我的项目背景就不说了，现在举一个例子吧：A,B两支股票都在上海，深圳上市，需要实时记录这两支股票的交易tick(不懂tick也没有关系)。现在的分片策略是：上海、深圳分别建库，每个库都存各自交易所的两支股票的ticktick，且按照月分表。如图：</p>
<ul>
<li>db_sh<ul>
<li>tick_a_2017_01</li>
<li>tick_b_2017_01</li>
<li>……..</li>
<li>tick_a_2017_12</li>
<li>tick_b_2017_12</li>
</ul>
</li>
<li><p>db_sz</p>
<ul>
<li><p>tick_a_2017_01</p>
<ul>
<li>tick_b_2017_01</li>
<li>……..</li>
<li>tick_a_2017_12</li>
<li>tick_b_2017_12</li>
</ul>
<p>分库分表就是这样的。根据这个建库。</p>
<p><strong>千万不要讨论这样分库分表是否合适，这里这样分片只是举个栗子，说明分库分表这个事情。</strong></p>
<p><strong>Sharding-jdbc是不支持建库的SQL，如果像我这样增量的数据库和数据表，那就要一次性把一段时期的数据库和数据表都要建好。</strong></p>
</li>
</ul>
</li>
</ul>
<h2 id="二、建库"><a href="#二、建库" class="headerlink" title="二、建库"></a>二、建库</h2><p>考虑到表确实多，所以我就只建1，2月份的表。语句见demo文件。</p>
<h2 id="三、springboot集成sharding-jdbc"><a href="#三、springboot集成sharding-jdbc" class="headerlink" title="三、springboot集成sharding-jdbc"></a>三、springboot集成sharding-jdbc</h2><p>mvn配置pom如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spartajet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-sharding-jdbc-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>springboot-sharding-jdbc-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Springboot integrate Sharding-jdbc Demo<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.build.locales</span>&gt;</span>zh_CN<span class="tag">&lt;/<span class="name">project.build.locales</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">project.build.jdk</span>&gt;</span>$&#123;java.version&#125;<span class="tag">&lt;/<span class="name">project.build.jdk</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">spring.boot.version</span>&gt;</span>1.4.1.RELEASE<span class="tag">&lt;/<span class="name">spring.boot.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">com.alibaba.druid.version</span>&gt;</span>1.0.13<span class="tag">&lt;/<span class="name">com.alibaba.druid.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mysql-connector-java.version</span>&gt;</span>5.1.36<span class="tag">&lt;/<span class="name">mysql-connector-java.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">sharding-jdbc.version</span>&gt;</span>1.4.1<span class="tag">&lt;/<span class="name">sharding-jdbc.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">com.google.code.gson.version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">com.google.code.gson.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">joda-trade.version</span>&gt;</span>2.9.7<span class="tag">&lt;/<span class="name">joda-trade.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">commons-dbcp.version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">commons-dbcp.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">commons-io.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">commons-io.version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mybatis-spring-boot-starter.version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">mybatis-spring-boot-starter.version</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-spring-boot-starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-dbcp.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.dangdang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;sharding-jdbc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.dangdang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-config-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;sharding-jdbc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.dangdang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-self-id-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;sharding-jdbc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;com.google.code.gson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>spring-boot-start-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>spring-boot-start-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector-java.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">source</span>&gt;</span>$&#123;project.build.jdk&#125;<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">target</span>&gt;</span>$&#123;project.build.jdk&#125;<span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">encoding</span>&gt;</span>$&#123;project.build.sourceEncoding&#125;<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<p>其实这个和sharding-jdbc的官网差不多。其实我想写一个<code>sharding-jdbc-spring-boot-starter</code>的pom的，等项目业务都做完再说吧。</p>
<h2 id="四、配置数据源"><a href="#四、配置数据源" class="headerlink" title="四、配置数据源"></a>四、配置数据源</h2><p>我想将数据库做成可配置的，所以我没有在<code>application.properties</code>文件中直接配置数据库，而是写在了<code>database.json</code>文件中。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"db_sh"</span>,</div><div class="line">    <span class="attr">"url"</span>: <span class="string">"jdbc:mysql://localhost:3306/db_sh"</span>,</div><div class="line">    <span class="attr">"username"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="attr">"password"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="attr">"driveClassName"</span>:<span class="string">"com.mysql.jdbc.Driver"</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"db_sz"</span>,</div><div class="line">    <span class="attr">"url"</span>: <span class="string">"jdbc:mysql://localhost:3306/db_sz"</span>,</div><div class="line">    <span class="attr">"username"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="attr">"password"</span>: <span class="string">"root"</span>,</div><div class="line">    <span class="attr">"driveClassName"</span>:<span class="string">"com.mysql.jdbc.Driver"</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>然后在springboot读取database文件，加载方式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Value</span>(<span class="string">"classpath:database.json"</span>)</div><div class="line">    <span class="keyword">private</span> Resource databaseFile;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;Database&gt; <span class="title">databases</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        String databasesString = IOUtils.toString(databaseFile.getInputStream(), Charset.forName(<span class="string">"UTF-8"</span>));</div><div class="line">        List&lt;Database&gt; databases = <span class="keyword">new</span> Gson().fromJson(databasesString, <span class="keyword">new</span> TypeToken&lt;List&lt;Database&gt;&gt;() &#123;</div><div class="line">        &#125;.getType());</div><div class="line">        <span class="keyword">return</span> databases;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>加载完database信息之后，可以通过工厂方法配置逻辑数据库：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function"><span class="keyword">public</span> HashMap&lt;String, DataSource&gt; <span class="title">dataSourceMap</span><span class="params">(List&lt;Database&gt; databases)</span> </span>&#123;</div><div class="line">    Map&lt;String, DataSource&gt; dataSourceMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (Database database : databases) &#123;</div><div class="line">        DataSourceBuilder dataSourceBuilder = DataSourceBuilder.create();</div><div class="line">        dataSourceBuilder.url(database.getUrl());</div><div class="line">        dataSourceBuilder.driverClassName(database.getDriveClassName());</div><div class="line">        dataSourceBuilder.username(database.getUsername());</div><div class="line">        dataSourceBuilder.password(database.getPassword());</div><div class="line">        DataSource dataSource = dataSourceBuilder.build();</div><div class="line">        dataSourceMap.put(database.getName(), dataSource);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> dataSourceMap;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就把各个逻辑数据库就加载好了。</p>
<h2 id="五、配置分片策略"><a href="#五、配置分片策略" class="headerlink" title="五、配置分片策略"></a>五、配置分片策略</h2><h3 id="5-1数据库分片策略"><a href="#5-1数据库分片策略" class="headerlink" title="5.1数据库分片策略"></a>5.1数据库分片策略</h3><p>在这个实例中，数据库的分库就是根据上海(sh)和深圳(sz)来分的，在sharding-jdbc中是单键分片。根据官方文档实现接口<code>SingleKeyDatabaseShardingAlgorithm</code>就可以</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseShardingAlgorithm</span> <span class="keyword">implements</span> <span class="title">SingleKeyDatabaseShardingAlgorithm</span>&lt;<span class="title">String</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根据分片值和SQL的=运算符计算分片结果名称集合.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> availableTargetNames 所有的可用目标名称集合, 一般是数据源或表名称</div><div class="line">     * <span class="doctag">@param</span> shardingValue        分片值</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> 分片后指向的目标名称, 一般是数据源或表名称</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doEqualSharding</span><span class="params">(Collection&lt;String&gt; availableTargetNames, ShardingValue&lt;String&gt; shardingValue)</span> </span>&#123;</div><div class="line">        String databaseName = <span class="string">""</span>;</div><div class="line">        <span class="keyword">for</span> (String targetName : availableTargetNames) &#123;</div><div class="line">            <span class="keyword">if</span> (targetName.endsWith(shardingValue.getValue())) &#123;</div><div class="line">                databaseName = targetName;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> databaseName;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此接口还有另外两个方法，<code>doInSharding</code>和<code>doBetweenSharding</code>，因为我暂时不用IN和BETWEEN方法，所以就没有写，直接返回null。</p>
<h3 id="5-2数据表分片策略"><a href="#5-2数据表分片策略" class="headerlink" title="5.2数据表分片策略"></a>5.2数据表分片策略</h3><p>数据表的分片策略是根据股票和时间共同决定的，在sharding-jdbc中是多键分片。根据官方文档，实现<code>MultipleKeysTableShardingAlgorithm</code>接口就OK了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableShardingAlgorithm</span> <span class="keyword">implements</span> <span class="title">MultipleKeysTableShardingAlgorithm</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根据分片值计算分片结果名称集合.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> availableTargetNames 所有的可用目标名称集合, 一般是数据源或表名称</div><div class="line">     * <span class="doctag">@param</span> shardingValues       分片值集合</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> 分片后指向的目标名称集合, 一般是数据源或表名称</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;String&gt; <span class="title">doSharding</span><span class="params">(Collection&lt;String&gt; availableTargetNames, Collection&lt;ShardingValue&lt;?&gt;&gt; shardingValues)</span> </span>&#123;</div><div class="line">        String name = <span class="keyword">null</span>;</div><div class="line">        Date time = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">for</span> (ShardingValue&lt;?&gt; shardingValue : shardingValues) &#123;</div><div class="line">            <span class="keyword">if</span> (shardingValue.getColumnName().equals(<span class="string">"name"</span>)) &#123;</div><div class="line">                name = ((ShardingValue&lt;String&gt;) shardingValue).getValue();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (shardingValue.getColumnName().equals(<span class="string">"time"</span>)) &#123;</div><div class="line">                time = ((ShardingValue&lt;Date&gt;) shardingValue).getValue();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (name != <span class="keyword">null</span> &amp;&amp; time != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        String timeString = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy_MM"</span>).format(time);</div><div class="line">        String suffix = name + <span class="string">"_"</span> + timeString;</div><div class="line">        Collection&lt;String&gt; result = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (String targetName : availableTargetNames) &#123;</div><div class="line">            <span class="keyword">if</span> (targetName.endsWith(suffix)) &#123;</div><div class="line">                result.add(targetName);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这些方法的使用可以查官方文档。</p>
<h3 id="5-3注入分片策略"><a href="#5-3注入分片策略" class="headerlink" title="5.3注入分片策略"></a>5.3注入分片策略</h3><p>以上只是定义了分片算法，还没有形成策略，还没有告诉shrding将哪个字段给分片算法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Configuration</div><div class="line">public class ShardingStrategyConfig &#123;</div><div class="line">    @Bean</div><div class="line">    public DatabaseShardingStrategy databaseShardingStrategy(DatabaseShardingAlgorithm databaseShardingAlgorithm) &#123;</div><div class="line">        DatabaseShardingStrategy databaseShardingStrategy = new DatabaseShardingStrategy(&quot;exchange&quot;, databaseShardingAlgorithm);</div><div class="line">        return databaseShardingStrategy;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public TableShardingStrategy tableShardingStrategy(TableShardingAlgorithm tableShardingAlgorithm) &#123;</div><div class="line">        Collection&lt;String&gt; columns = new LinkedList&lt;&gt;();</div><div class="line">        columns.add(&quot;name&quot;);</div><div class="line">        columns.add(&quot;time&quot;);</div><div class="line">        TableShardingStrategy tableShardingStrategy = new TableShardingStrategy(columns, tableShardingAlgorithm);</div><div class="line">        return tableShardingStrategy;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样才能形成完成的分片策略。</p>
<h2 id="六、配置Sharding-jdbc的DataSource"><a href="#六、配置Sharding-jdbc的DataSource" class="headerlink" title="六、配置Sharding-jdbc的DataSource"></a>六、配置Sharding-jdbc的DataSource</h2><p>sharding-jdbc的原理其实很简单，就是自己做一个DataSource给上层应用使用，这个DataSource包含所有的逻辑库和逻辑表，应用增删改查时，他自己再修改sql，然后选择合适的数据库继续操作。所以这个DataSource创建很重要。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="meta">@Primary</span></div><div class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">shardingDataSource</span><span class="params">(HashMap&lt;String, DataSource&gt; dataSourceMap, DatabaseShardingStrategy databaseShardingStrategy, TableShardingStrategy tableShardingStrategy)</span> </span>&#123;</div><div class="line">    DataSourceRule dataSourceRule = <span class="keyword">new</span> DataSourceRule(dataSourceMap);</div><div class="line">    TableRule tableRule = TableRule.builder(<span class="string">"tick"</span>).actualTables(Arrays.asList(<span class="string">"db_sh.tick_a_2017_01"</span>, <span class="string">"db_sh.tick_a_2017_02"</span>, <span class="string">"db_sh.tick_b_2017_01"</span>, <span class="string">"db_sh.tick_b_2017_02"</span>, <span class="string">"db_sz.tick_a_2017_01"</span>, <span class="string">"db_sz.tick_a_2017_02"</span>, <span class="string">"db_sz.tick_b_2017_01"</span>, <span class="string">"db_sz.tick_a_2017_02"</span>)).dataSourceRule(dataSourceRule).build();</div><div class="line">    ShardingRule shardingRule = ShardingRule.builder().dataSourceRule(dataSourceRule).tableRules(Arrays.asList(tableRule)).databaseShardingStrategy(databaseShardingStrategy).tableShardingStrategy(tableShardingStrategy).build();</div><div class="line">    DataSource shardingDataSource = ShardingDataSourceFactory.createDataSource(shardingRule);</div><div class="line">    <span class="keyword">return</span> shardingDataSource;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>这里要着重说一下为什么要用@Primary这个注解，没有这个注解是会报错的，错误大致意思就是DataSource太多了，mybatis不知道用哪个。加上这个mybatis就知道用sharding的DataSource了。这里参考的是jpa的多数据源配置</strong></p>
<h2 id="七、配置mybatis"><a href="#七、配置mybatis" class="headerlink" title="七、配置mybatis"></a>七、配置mybatis</h2><h3 id="7-1-Bean"><a href="#7-1-Bean" class="headerlink" title="7.1 Bean"></a>7.1 Bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tick</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> String exchange;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ask;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bid;</div><div class="line">    <span class="keyword">private</span> Date time;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="7-2-Mapper"><a href="#7-2-Mapper" class="headerlink" title="7.2 Mapper"></a>7.2 Mapper</h3><p>很简单，只实现一个插入方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Mapper</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TickMapper</span> </span>&#123;</div><div class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into tick (id,name,exchange,ask,bid,time) values (#&#123;id&#125;,#&#123;name&#125;,#&#123;exchange&#125;,#&#123;ask&#125;,#&#123;bid&#125;,#&#123;time&#125;)"</span>)</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertTick</span><span class="params">(Tick tick)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="7-3-SessionFactory配置"><a href="#7-3-SessionFactory配置" class="headerlink" title="7.3 SessionFactory配置"></a>7.3 SessionFactory配置</h3><p>还要设置一下tick的SessionFactory：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Configuration</div><div class="line">@MapperScan(basePackages = &quot;com.spartajet.shardingboot.mapper&quot;, sqlSessionFactoryRef = &quot;sessionFactory&quot;)</div><div class="line">public class TickSessionFactoryConfig &#123;</div><div class="line">    @Bean</div><div class="line">    public SqlSessionFactory sessionFactory(DataSource shardingDataSource) throws Exception &#123;</div><div class="line">        final SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean();</div><div class="line">        sessionFactory.setDataSource(shardingDataSource);</div><div class="line">        return sessionFactory.getObject();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public CommonSelfIdGenerator commonSelfIdGenerator() &#123;</div><div class="line">        CommonSelfIdGenerator.setClock(AbstractClock.systemClock());</div><div class="line">        CommonSelfIdGenerator commonSelfIdGenerator = new CommonSelfIdGenerator();</div><div class="line">        return commonSelfIdGenerator;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里添加了一个<code>CommonSelfIdGenerator</code>，sharding自带的id生成器，看了下代码和<code>facebook</code>的<code>snowflake</code>类似。我又不想把数据库的主键设置成自增的，否则数据双向同步会死的很惨的。</p>
<p>### </p>
<h2 id="八、测试写入"><a href="#八、测试写入" class="headerlink" title="八、测试写入"></a>八、测试写入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@RunWith(SpringJUnit4ClassRunner.class)</div><div class="line">@SpringBootTest</div><div class="line">public class SpringbootShardingJdbcDemoApplicationTests &#123;</div><div class="line">    @Autowired</div><div class="line">    private TickMapper tickMapper;</div><div class="line">    @Autowired</div><div class="line">    private CommonSelfIdGenerator commonSelfIdGenerator;</div><div class="line">    </div><div class="line">    </div><div class="line">    @Test</div><div class="line">    public void contextLoads() &#123;</div><div class="line">        Tick tick = new Tick(commonSelfIdGenerator.generateId().longValue(), &quot;a&quot;, &quot;sh&quot;, 100, 200, new Date());</div><div class="line">        this.tickMapper.insertTick(tick);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>成功实现增量分库分表！！！</p>
]]></content>
      
        
        <tags>
            
            <tag> springboot </tag>
            
            <tag> sharding-jdbc </tag>
            
            <tag> 分库分表 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2017/05/19/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
      
        
    </entry>
    
  
  
</search>
